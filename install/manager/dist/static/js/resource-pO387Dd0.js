import{_ as B,J as p,q as n,M as F,o as d,c as y,b as g,m as l,A as t,v as a,N,j as _,w as b,t as T,F as D,i as L}from"./index-4T4wOeym.js";import q from"./docker_resource_sync-qxdO_l7u.js";const E={name:"compose_db",components:{docker_resource_sync:q},data(){return{loading_build:!1,syncDialog:!1,docker_type_list:[{label:"远程镜像",id:1},{label:"本地镜像",id:2}],resource_type_list:[{label:"CTF",id:"CTF"},{label:"VUL",id:"VUL"}],form:{resource_type:"CTF",docker_type:1},centerDialogVisible:!1,listQuery:{},listLoading:!1,list:[],total:0}},created(){this.getList()},methods:{getList(){p.get("/api/admin/docker/resource").then(s=>{let{data:o,total:k}=s;this.list=o,this.total=k})},handleCreate(){this.centerDialogVisible=!0},handleEdit(s){this.form=s,this.centerDialogVisible=!0},handleBuild(s){this.loading_build=!0,p.post(`/api/admin/docker/resource/${s}/build`).then(o=>{this.loading_build=!1,this.$message({message:"任务提交成功",type:"success"}),this.getList()})},handleDelete(s){p.delete(`/api/admin/docker/resource/${s}`).then(o=>{this.$message({message:"删除成功",type:"success"}),this.getList()})},handleSubmit(){this.form.id?p.put(`/api/admin/docker/resource/${this.form.id}`,this.form).then(s=>{this.$message({message:"修改成功",type:"success"}),this.form={},this.centerDialogVisible=!1,this.getList()}):p.post("/api/admin/docker/resource",this.form).then(s=>{this.$message({message:"添加成功",type:"success"}),this.form={},this.centerDialogVisible=!1,this.getList()})},handleSizeChange(s){this.listQuery.page_size=s,this.fetchData()},handleCurrentChange(s){this.listQuery.page=s,this.fetchData()},handleSyncClose(){this.syncDialog=!1,this.getList()}}},j={class:"page-container"},A={class:"widget"},J=g("div",{class:"tool-bar"},"资源中心",-1),M={class:"search-group"},G={class:"widget-content"},H={class:"page-r"};function I(s,o,k,K,i,r){const h=n("el-input"),u=n("el-form-item"),c=n("el-button"),C=n("el-form"),m=n("el-table-column"),f=n("el-tag"),x=n("el-table"),z=n("el-pagination"),V=n("el-option"),w=n("el-select"),S=n("el-dialog"),U=n("docker_resource_sync"),Q=F("loading");return d(),y("div",j,[g("div",A,[J,g("div",M,[l(C,{inline:""},{default:t(()=>[l(u,null,{default:t(()=>[l(h,{modelValue:i.listQuery.search,"onUpdate:modelValue":o[0]||(o[0]=e=>i.listQuery.search=e),style:{width:"200px"},placeholder:"名称"},null,8,["modelValue"])]),_:1}),l(u,null,{default:t(()=>[l(c,{type:"primary",onClick:o[1]||(o[1]=e=>r.getList())},{default:t(()=>[a("查询")]),_:1}),l(c,{type:"primary",onClick:r.handleCreate},{default:t(()=>[a("添加")]),_:1},8,["onClick"])]),_:1})]),_:1})]),g("div",G,[N((d(),_(x,{fit:"","highlight-current-row":"",stripe:"",data:i.list,style:{width:"100%"}},{default:t(()=>[l(m,{label:"名称",prop:"name",align:"center"}),l(m,{label:"镜像",prop:"image",width:"250px",align:"center"}),l(m,{label:"资源类型",prop:"resource_type",width:"150px",align:"center"}),l(m,{label:"加载类型",prop:"docker_type_name",width:"150px",align:"center"}),l(m,{label:"描述",prop:"description",width:"150px",align:"center"}),l(m,{width:"180px",align:"center",label:"状态"},{default:t(e=>[e.row.status===0?(d(),_(f,{key:0},{default:t(()=>[a("初始化")]),_:1})):b("",!0),e.row.status===1?(d(),_(f,{key:1},{default:t(()=>[a("已编译")]),_:1})):b("",!0),e.row.status===2?(d(),_(f,{key:2},{default:t(()=>[a("编译失败")]),_:1})):b("",!0)]),_:1}),l(m,{align:"center",label:"操作",width:"200"},{default:t(e=>[l(c,{link:"",type:"primary",onClick:v=>r.handleEdit(e.row)},{default:t(()=>[a("编辑")]),_:2},1032,["onClick"]),l(c,{link:"",loading:i.loading_build,type:"primary",onClick:v=>r.handleBuild(e.row.id)},{default:t(()=>[a(T(e.row.status===0?"编译":"重新编译"),1)]),_:2},1032,["loading","onClick"]),l(c,{link:"",type:"danger",onClick:v=>r.handleDelete(e.row.id)},{default:t(()=>[a("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Q,i.listLoading]]),g("div",H,[l(z,{background:"","current-page":i.listQuery.page,"page-sizes":[10,20,30,50],"page-size":i.listQuery.page_size,layout:"total, sizes, prev, pager, next, jumper",total:i.total,onSizeChange:r.handleSizeChange,onCurrentChange:r.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])])]),l(S,{modelValue:i.centerDialogVisible,"onUpdate:modelValue":o[8]||(o[8]=e=>i.centerDialogVisible=e),title:"添加资源",width:"40%",center:""},{footer:t(()=>[l(c,{onClick:o[7]||(o[7]=e=>i.centerDialogVisible=!1)},{default:t(()=>[a("取 消")]),_:1}),l(c,{type:"primary",onClick:r.handleSubmit},{default:t(()=>[a("提交")]),_:1},8,["onClick"])]),default:t(()=>[l(C,{"label-width":"100"},{default:t(()=>[l(u,{label:"资源名称",docker_type_list:""},{default:t(()=>[l(h,{modelValue:i.form.name,"onUpdate:modelValue":o[2]||(o[2]=e=>i.form.name=e)},null,8,["modelValue"])]),_:1}),l(u,{label:"资源类型",required:""},{default:t(()=>[l(w,{modelValue:i.form.resource_type,"onUpdate:modelValue":o[3]||(o[3]=e=>i.form.resource_type=e)},{default:t(()=>[(d(!0),y(D,null,L(i.resource_type_list,e=>(d(),_(V,{label:e.label,key:e.id,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"加载类型",required:""},{default:t(()=>[l(w,{modelValue:i.form.docker_type,"onUpdate:modelValue":o[4]||(o[4]=e=>i.form.docker_type=e)},{default:t(()=>[(d(!0),y(D,null,L(i.docker_type_list,e=>(d(),_(V,{label:e.label,key:e.id,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"镜像名称"},{default:t(()=>[l(h,{modelValue:i.form.image,"onUpdate:modelValue":o[5]||(o[5]=e=>i.form.image=e)},null,8,["modelValue"])]),_:1}),l(u,{label:"描述"},{default:t(()=>[l(h,{modelValue:i.form.description,"onUpdate:modelValue":o[6]||(o[6]=e=>i.form.description=e)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(U,{onClose:r.handleSyncClose,open:i.syncDialog},null,8,["onClose","open"])])}const R=B(E,[["render",I]]);export{R as default};
