import{_ as U,az as u,q as r,o as m,j as d,A as o,m as a,v as g,c as f,F as b,i as v,b as h,t as O}from"./index-cdc3a115.js";const B={name:"addQuestion",props:{show:Boolean,data:Object},data(){return{visible:!1,resource_list:[],hostOption:[],imageOption:[],capture:null,fileChange:!1,options:[],attachment:[],form:{attachment:[],resource_id:null,name:null,flag:null,desc:null,score:null,type:null,active:!0,active_flag:!1},rules:{name:[{required:!0,message:"请输入名称",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],type:[{required:!0,message:"请选择类别",trigger:"blur"}],desc:[{required:!0,message:"请填写描述信息",trigger:"blur"},{min:3,max:200,message:"长度在 3 到 200 个字符",trigger:"blur"}],flag:[{required:!0,message:"请输入flag",trigger:"blur"},{min:3,max:64,message:"长度在 3 到 64 个字符",trigger:"blur"}]}}},watch:{show(i){this.visible=i},data:{handler(i){i&&(this.form.id=this.data.id,this.form.name=this.data.name,this.form.flag=this.data.flag,this.form.desc=this.data.desc,this.form.active_flag=this.data.active_flag,this.form.type=this.data.type,this.form.active=this.data.active,this.form.score=this.data.score,this.form.resource_id=this.data.resource_id,this.form.active&&this.getDockerHost(),this.data.attachment&&this.data.attachment.length>0&&(this.attachment=this.form.attachment))},deep:!0}},created(){this.getOptions(),this.getResourceList(),this.data.id&&(this.form.id=this.data.id,this.form.name=this.data.name,this.form.flag=this.data.flag,this.form.desc=this.data.desc,this.form.active_flag=this.data.active_flag,this.form.type=this.data.type,this.form.active=this.data.active,this.form.score=this.data.score,this.form.resource_id=this.data.resource_id,this.form.active&&this.getDockerHost(),this.data.attachment.length>0&&(this.attachment=this.form.attachment))},methods:{getOptions(){u.get("/api/admin/ctf/question/type").then(i=>{this.options=i.data})},getResourceList(){u.get("/api/admin/docker/resource",{page_size:99999,status:1}).then(i=>{this.resource_list=i.data})},getDockerHost(){u.get("/api/admin/docker/host",{page_size:999}).then(i=>{this.hostOption=i.data})},cancel(){this.$emit("action",!1)},submit(){this.form.attachment=[];for(let i=0;i<this.attachment.length;i++)this.form.attachment.push(this.attachment[i].uuid);this.$refs.form.validate(i=>{i&&(this.form.id?u.put(`/api/admin/ctf/question/${this.form.id}`,this.form).then(l=>{this.$emit("action",!0),this.$message({message:"提交成功",type:"success"})}).catch(l=>{}):u.post("/api/admin/ctf/question",this.form).then(l=>{this.$emit("action",!0)}).catch(l=>{}))})},handleFileClick(){document.getElementById("inputFile").click()},changeActiveFlag(i){i&&this.getDockerHost()},removeFile(i){this.fileChange=!0,this.attachment.splice(i,1)},handleFile(){let l=this.$refs.inputer.files[0],p=new FormData;p.append("file",l),u.post("/api/admin/ctf/upload",p).then(V=>{this.fileChange=!0;let{uuid:t,filename:s}=V;this.attachment.push({uuid:t,filename:s})})}}},H={style:{width:"300px"}},I={class:"file-item"},z=["href"],A=["onClick"];function L(i,l,p,V,t,s){const c=r("el-input"),n=r("el-form-item"),k=r("el-option"),y=r("el-select"),C=r("el-switch"),F=r("el-col"),w=r("el-row"),_=r("el-button"),q=r("el-form"),x=r("el-dialog");return m(),d(x,{"before-close":s.cancel,"show-close":!0,title:t.form.id?"编辑题目":"添加题目",modelValue:t.visible,"onUpdate:modelValue":l[9]||(l[9]=e=>t.visible=e),width:"40%"},{footer:o(()=>[a(_,{onClick:s.cancel},{default:o(()=>[g("取 消")]),_:1},8,["onClick"]),a(_,{type:"primary",onClick:s.submit},{default:o(()=>[g("确 定")]),_:1},8,["onClick"])]),default:o(()=>[a(q,{model:t.form,ref:"form",class:"form","label-width":"80px",rules:t.rules},{default:o(()=>[a(n,{label:"名称",prop:"name"},{default:o(()=>[a(c,{modelValue:t.form.name,"onUpdate:modelValue":l[0]||(l[0]=e=>t.form.name=e)},null,8,["modelValue"])]),_:1}),a(n,{label:"类别",prop:"type"},{default:o(()=>[a(y,{modelValue:t.form.type,"onUpdate:modelValue":l[1]||(l[1]=e=>t.form.type=e)},{default:o(()=>[(m(!0),f(b,null,v(t.options,e=>(m(),d(k,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(n,{class:"block-input",label:"是否激活"},{default:o(()=>[a(C,{modelValue:t.form.active,"onUpdate:modelValue":l[2]||(l[2]=e=>t.form.active=e)},null,8,["modelValue"])]),_:1}),a(n,{class:"block-input",label:"动态Flag"},{default:o(()=>[a(C,{modelValue:t.form.active_flag,"onUpdate:modelValue":l[3]||(l[3]=e=>t.form.active_flag=e),onChange:s.changeActiveFlag},null,8,["modelValue","onChange"])]),_:1}),t.form.active_flag?(m(),d(n,{key:0,required:"",class:"block-input",label:"环境",prop:"resource_id"},{default:o(()=>[a(y,{modelValue:t.form.resource_id,"onUpdate:modelValue":l[4]||(l[4]=e=>t.form.resource_id=e),clearable:""},{default:o(()=>[(m(!0),f(b,null,v(t.resource_list,e=>(m(),d(k,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):(m(),d(n,{key:1,class:"block-input",label:"Flag",prop:"flag"},{default:o(()=>[a(w,null,{default:o(()=>[a(F,{span:20},{default:o(()=>[a(c,{modelValue:t.form.flag,"onUpdate:modelValue":l[5]||(l[5]=e=>t.form.flag=e)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})),a(n,{label:"描述",prop:"desc"},{default:o(()=>[a(c,{modelValue:t.form.desc,"onUpdate:modelValue":l[6]||(l[6]=e=>t.form.desc=e),type:"textarea"},null,8,["modelValue"])]),_:1}),a(w,null,{default:o(()=>[a(F,{span:8},{default:o(()=>[a(n,{label:"积分",required:""},{default:o(()=>[a(c,{modelValue:t.form.score,"onUpdate:modelValue":l[7]||(l[7]=e=>t.form.score=e),type:"number"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(n,{label:"附件"},{default:o(()=>[h("input",{id:"inputFile",ref:"inputer",style:{display:"none"},type:"file",onChange:l[8]||(l[8]=(...e)=>s.handleFile&&s.handleFile(...e))},null,544),a(_,{type:"primary",onClick:s.handleFileClick},{default:o(()=>[g("上传")]),_:1},8,["onClick"]),h("div",H,[(m(!0),f(b,null,v(t.attachment,(e,D)=>(m(),f("div",I,[h("a",{href:e.filename,target:"_blank"},O(e.filename),9,z),h("i",{class:"el-icon-close",onClick:N=>s.removeFile(D)},null,8,A)]))),256))])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["before-close","title","modelValue"])}const E=U(B,[["render",L],["__scopeId","data-v-7c279426"]]);export{E as default};
