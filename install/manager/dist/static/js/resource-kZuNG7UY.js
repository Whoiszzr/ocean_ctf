import{_ as B,az as p,q as s,L as F,o as d,c as y,b as g,m as e,A as t,v as a,M as N,j as _,w as b,t as T,F as D,i as L}from"./index-R3no099A.js";import q from"./docker_resource_sync-SrlEd_1l.js";const E={name:"compose_db",components:{docker_resource_sync:q},data(){return{loading_build:!1,syncDialog:!1,docker_type_list:[{label:"远程镜像",id:1}],resource_type_list:[{label:"CTF",id:"CTF"},{label:"VUL",id:"VUL"}],form:{resource_type:"CTF",docker_type:1},centerDialogVisible:!1,listQuery:{},listLoading:!1,list:[],total:0}},created(){this.getList()},methods:{getList(){p.get("/api/admin/docker/resource").then(n=>{let{data:i,total:k}=n;this.list=i,this.total=k})},handleCreate(){this.centerDialogVisible=!0},handleEdit(n){this.form=n,this.centerDialogVisible=!0},handleSyncDockerhub(){this.syncDialog=!0},handleBuild(n){this.loading_build=!0,p.post(`/api/admin/docker/resource/${n}/build`).then(i=>{this.loading_build=!1,this.$message({message:"任务提交成功",type:"success"}),this.getList()})},handleDelete(n){p.delete(`/api/admin/docker/resource/${n}`).then(i=>{this.$message({message:"删除成功",type:"success"}),this.getList()})},handleSubmit(){this.form.id?p.put(`/api/admin/docker/resource/${this.form.id}`,this.form).then(n=>{this.$message({message:"修改成功",type:"success"}),this.form={},this.centerDialogVisible=!1,this.getList()}):p.post("/api/admin/docker/resource",this.form).then(n=>{this.$message({message:"添加成功",type:"success"}),this.form={},this.centerDialogVisible=!1,this.getList()})},handleSizeChange(n){this.listQuery.page_size=n,this.fetchData()},handleCurrentChange(n){this.listQuery.page=n,this.fetchData()},handleSyncClose(){this.syncDialog=!1,this.getList()}}},j={class:"page-container"},A={class:"widget"},M=g("div",{class:"tool-bar"},"资源中心",-1),G={class:"search-group"},H={class:"widget-content"},I={class:"page-r"};function J(n,i,k,K,o,r){const h=s("el-input"),c=s("el-form-item"),u=s("el-button"),C=s("el-form"),m=s("el-table-column"),f=s("el-tag"),x=s("el-table"),z=s("el-pagination"),V=s("el-option"),w=s("el-select"),S=s("el-dialog"),U=s("docker_resource_sync"),Q=F("loading");return d(),y("div",j,[g("div",A,[M,g("div",G,[e(C,{inline:""},{default:t(()=>[e(c,null,{default:t(()=>[e(h,{modelValue:o.listQuery.search,"onUpdate:modelValue":i[0]||(i[0]=l=>o.listQuery.search=l),style:{width:"200px"},placeholder:"名称"},null,8,["modelValue"])]),_:1}),e(c,null,{default:t(()=>[e(u,{type:"primary",onClick:i[1]||(i[1]=l=>r.getList())},{default:t(()=>[a("查询")]),_:1}),e(u,{type:"primary",onClick:r.handleCreate},{default:t(()=>[a("添加")]),_:1},8,["onClick"]),e(u,{type:"primary",onClick:r.handleSyncDockerhub},{default:t(()=>[a("同步Docker仓库资源")]),_:1},8,["onClick"])]),_:1})]),_:1})]),g("div",H,[N((d(),_(x,{fit:"","highlight-current-row":"",stripe:"",data:o.list,style:{width:"100%"}},{default:t(()=>[e(m,{label:"名称",prop:"name",align:"center"}),e(m,{label:"镜像",prop:"image",width:"250px",align:"center"}),e(m,{label:"资源类型",prop:"resource_type",width:"150px",align:"center"}),e(m,{label:"加载类型",prop:"docker_type_name",width:"150px",align:"center"}),e(m,{label:"描述",prop:"description",width:"150px",align:"center"}),e(m,{width:"180px",align:"center",label:"状态"},{default:t(l=>[l.row.status===0?(d(),_(f,{key:0},{default:t(()=>[a("初始化")]),_:1})):b("",!0),l.row.status===1?(d(),_(f,{key:1},{default:t(()=>[a("已编译")]),_:1})):b("",!0),l.row.status===2?(d(),_(f,{key:2},{default:t(()=>[a("编译失败")]),_:1})):b("",!0)]),_:1}),e(m,{align:"center",label:"操作",width:"200"},{default:t(l=>[e(u,{link:"",type:"primary",onClick:v=>r.handleEdit(l.row)},{default:t(()=>[a("编辑")]),_:2},1032,["onClick"]),e(u,{link:"",loading:o.loading_build,type:"primary",onClick:v=>r.handleBuild(l.row.id)},{default:t(()=>[a(T(l.row.status===0?"编译":"重新编译"),1)]),_:2},1032,["loading","onClick"]),e(u,{link:"",type:"danger",onClick:v=>r.handleDelete(l.row.id)},{default:t(()=>[a("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Q,o.listLoading]]),g("div",I,[e(z,{background:"","current-page":o.listQuery.page,"page-sizes":[10,20,30,50],"page-size":o.listQuery.page_size,layout:"total, sizes, prev, pager, next, jumper",total:o.total,onSizeChange:r.handleSizeChange,onCurrentChange:r.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])])]),e(S,{modelValue:o.centerDialogVisible,"onUpdate:modelValue":i[8]||(i[8]=l=>o.centerDialogVisible=l),title:"添加资源",width:"40%",center:""},{footer:t(()=>[e(u,{onClick:i[7]||(i[7]=l=>o.centerDialogVisible=!1)},{default:t(()=>[a("取 消")]),_:1}),e(u,{type:"primary",onClick:r.handleSubmit},{default:t(()=>[a("提交")]),_:1},8,["onClick"])]),default:t(()=>[e(C,{"label-width":"100"},{default:t(()=>[e(c,{label:"资源名称",docker_type_list:""},{default:t(()=>[e(h,{modelValue:o.form.name,"onUpdate:modelValue":i[2]||(i[2]=l=>o.form.name=l)},null,8,["modelValue"])]),_:1}),e(c,{label:"资源类型",required:""},{default:t(()=>[e(w,{modelValue:o.form.resource_type,"onUpdate:modelValue":i[3]||(i[3]=l=>o.form.resource_type=l)},{default:t(()=>[(d(!0),y(D,null,L(o.resource_type_list,l=>(d(),_(V,{label:l.label,key:l.id,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"加载类型",required:""},{default:t(()=>[e(w,{modelValue:o.form.docker_type,"onUpdate:modelValue":i[4]||(i[4]=l=>o.form.docker_type=l)},{default:t(()=>[(d(!0),y(D,null,L(o.docker_type_list,l=>(d(),_(V,{label:l.label,key:l.id,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"镜像名称"},{default:t(()=>[e(h,{modelValue:o.form.image,"onUpdate:modelValue":i[5]||(i[5]=l=>o.form.image=l)},null,8,["modelValue"])]),_:1}),e(c,{label:"描述"},{default:t(()=>[e(h,{modelValue:o.form.description,"onUpdate:modelValue":i[6]||(i[6]=l=>o.form.description=l)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(U,{onClose:r.handleSyncClose,open:o.syncDialog},null,8,["onClose","open"])])}const R=B(E,[["render",J]]);export{R as default};
