import{_ as V,aD as I,aF as N,az as F,q as n,o as p,c as m,b as o,m as e,A as t,v as i,F as E,i as H,t as T,ai as q,aj as B}from"./index-cdc3a115.js";const C={name:"addImage",components:{Edit:I,Files:N},data(){return{rules:{tag:[{required:!0,max:100,min:2,message:"请输入要构建的镜像名称"}]},selectHub:"DockerHub",imageName:"",buildForm:{tag:""},options:[{value:"DockerHub",label:"DockerHub"}],file:null,output:[],pk:null,content:"",listTotal:0,listData:[],showLog:!1}},created(){this.pk=this.$route.query.id},methods:{getFile(a,l){l.length>1&&l.splice(0,1),this.file=a.raw},build(){this.$refs.build.validate(a=>{if(!a)return!1;let l;this.$refs.tab.currentName==="tar"?(l=new FormData,l.append("type","tar"),l.append("files",this.file)):this.$refs.tab.currentName==="pull"?l={tag:this.imageName}:l={dockerfile:this.content,tag:this.tag},F.post(`/api/admin/docker/image?build_type=${this.$refs.tab.currentName}&tag=${this.buildForm.tag}`,l).then(u=>{this.$message({message:"任务已提交",type:"success"}),this.showLog=!0,this.output=[],this.loopResponse(u.data.task)}).catch(u=>{})})},loopResponse(a){let l,u=this,f={index:this.output.length};F.get(`/api/admin/task/${a}/log`,f).then(function(s){u.output=u.output.concat(s.data);let d=document.getElementById("log_output");d.scrollTop=d.scrollHeight,s.end?clearTimeout(l):l=setTimeout(()=>{u.loopResponse(a)},5e3)})}}},_=a=>(q("data-v-69eae4f6"),a=a(),B(),a),S={class:"container"},L={class:"widget"},R=_(()=>o("i",{class:"el-icon-edit"},null,-1)),$=_(()=>o("i",{class:"el-icon-upload2"},null,-1)),A=_(()=>o("i",{class:"el-icon-edit"},null,-1)),U=_(()=>o("div",{class:"wd-title"},"Actions",-1)),j={class:"action-group"},z={id:"log_output",class:"output",style:{"max-height":"300px",overflow:"auto"}},P={class:"pre"},Y={class:"line small"};function G(a,l,u,f,s,d){const w=n("Edit"),h=n("el-icon"),g=n("el-input"),b=n("el-form-item"),v=n("el-form"),c=n("el-tab-pane"),k=n("el-button"),x=n("el-upload"),y=n("el-tabs"),D=n("Files");return p(),m("div",S,[o("div",L,[e(y,{type:"border-card"},{default:t(()=>[e(c,null,{label:t(()=>[e(h,null,{default:t(()=>[e(w)]),_:1}),i("添加镜像")]),default:t(()=>[e(v,{model:s.buildForm,inline:"",ref:"build",rules:s.rules},{default:t(()=>[e(b,{label:"名称",prop:"tag"},{default:t(()=>[e(g,{modelValue:s.buildForm.tag,"onUpdate:modelValue":l[0]||(l[0]=r=>s.buildForm.tag=r),placeholder:"eg. redis:latest"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),e(y,{value:"dockerfile",ref:"tab"},{default:t(()=>[e(c,{name:"dockerfile"},{label:t(()=>[R,i(" DockerFile")]),default:t(()=>[o("div",null,[e(v,null,{default:t(()=>[e(b,null,{default:t(()=>[e(g,{modelValue:s.content,"onUpdate:modelValue":l[1]||(l[1]=r=>s.content=r),type:"textarea",rows:"10",placeholder:"Define or paste the content of Your Dockerfile here"},null,8,["modelValue"])]),_:1})]),_:1})])]),_:1}),e(c,{name:"tar"},{label:t(()=>[$,i(" 上传")]),default:t(()=>[o("div",null,[o("div",null,[e(x,{accept:"*.tar","on-change":d.getFile,action:"",ref:"upload","auto-upload":!1},{default:t(()=>[e(k,{type:"primary"},{default:t(()=>[i("选择文件")]),_:1})]),_:1},8,["on-change"])])])]),_:1}),e(c,{name:"pull"},{label:t(()=>[A,i("Pull")]),_:1})]),_:1},512),o("div",null,[U,o("div",j,[e(k,{onClick:d.build,type:"primary"},{default:t(()=>[i("上传/编译")]),_:1},8,["onClick"])])])]),_:1}),e(c,{disabled:!s.showLog},{label:t(()=>[e(h,null,{default:t(()=>[e(D)]),_:1}),i("日志")]),default:t(()=>[o("div",z,[o("pre",P,[i("               "),(p(!0),m(E,null,H(s.output,r=>(p(),m("code",Y,T(r),1))),256)),i(`
              `)])])]),_:1},8,["disabled"])]),_:1})])])}const K=V(C,[["render",G],["__scopeId","data-v-69eae4f6"]]);export{K as default};
