import{_ as B,az as p,q as s,J as F,o as d,c as b,b as g,m as l,A as t,v as a,K as N,j as _,w as f,F as D,i as L}from"./index-570ffed7.js";import T from"./docker_resource_sync-e39962b7.js";const q={name:"compose_db",components:{docker_resource_sync:T},data(){return{loading_build:!1,syncDialog:!1,docker_type_list:[{label:"远程镜像",id:1}],resource_type_list:[{label:"CTF",id:"CTF"},{label:"VUL",id:"VUL"}],form:{resource_type:"CTF",docker_type:1},centerDialogVisible:!1,listQuery:{},listLoading:!1,list:[],total:0}},created(){this.getList()},methods:{getList(){p.get("/api/admin/docker/resource").then(n=>{let{data:i,total:k}=n;this.list=i,this.total=k})},handleCreate(){this.centerDialogVisible=!0},handleEdit(n){this.form=n,this.centerDialogVisible=!0},handleSyncDockerhub(){this.syncDialog=!0},handleBuild(n){this.loading_build=!0,p.post(`/api/admin/docker/resource/${n}/build`).then(i=>{this.loading_build=!1,this.$message({message:"编译完成",type:"success"}),this.getList()})},handleDelete(n){p.delete(`/api/admin/docker/resource/${n}`).then(i=>{this.$message({message:"删除成功",type:"success"}),this.getList()})},handleSubmit(){this.form.id?p.put(`/api/admin/docker/resource/${this.form.id}`,this.form).then(n=>{this.$message({message:"修改成功",type:"success"}),this.form={},this.centerDialogVisible=!1,this.getList()}):p.post("/api/admin/docker/resource",this.form).then(n=>{this.$message({message:"添加成功",type:"success"}),this.form={},this.centerDialogVisible=!1,this.getList()})},handleSizeChange(n){this.listQuery.page_size=n,this.fetchData()},handleCurrentChange(n){this.listQuery.page=n,this.fetchData()},handleSyncClose(){this.syncDialog=!1,this.getList()}}},E={class:"page-container"},j={class:"widget"},A=g("div",{class:"tool-bar"},"资源中心",-1),J={class:"search-group"},K={class:"widget-content"},G={class:"page-r"};function H(n,i,k,I,o,r){const h=s("el-input"),c=s("el-form-item"),u=s("el-button"),C=s("el-form"),m=s("el-table-column"),y=s("el-tag"),x=s("el-table"),z=s("el-pagination"),V=s("el-option"),w=s("el-select"),S=s("el-dialog"),U=s("docker_resource_sync"),Q=F("loading");return d(),b("div",E,[g("div",j,[A,g("div",J,[l(C,{inline:""},{default:t(()=>[l(c,null,{default:t(()=>[l(h,{modelValue:o.listQuery.search,"onUpdate:modelValue":i[0]||(i[0]=e=>o.listQuery.search=e),style:{width:"200px"},placeholder:"名称"},null,8,["modelValue"])]),_:1}),l(c,null,{default:t(()=>[l(u,{type:"primary",onClick:i[1]||(i[1]=e=>r.getList())},{default:t(()=>[a("查询")]),_:1}),l(u,{type:"primary",onClick:r.handleCreate},{default:t(()=>[a("添加")]),_:1},8,["onClick"]),l(u,{type:"primary",onClick:r.handleSyncDockerhub},{default:t(()=>[a("同步Docker仓库资源")]),_:1},8,["onClick"])]),_:1})]),_:1})]),g("div",K,[N((d(),_(x,{fit:"","highlight-current-row":"",stripe:"",data:o.list,style:{width:"100%"}},{default:t(()=>[l(m,{label:"名称",prop:"name",align:"center"}),l(m,{label:"镜像",prop:"image",width:"250px",align:"center"}),l(m,{label:"资源类型",prop:"resource_type",width:"150px",align:"center"}),l(m,{label:"加载类型",prop:"docker_type_name",width:"150px",align:"center"}),l(m,{label:"描述",prop:"description",width:"150px",align:"center"}),l(m,{width:"180px",align:"center",label:"状态"},{default:t(e=>[e.row.status===0?(d(),_(y,{key:0},{default:t(()=>[a("初始化")]),_:1})):f("",!0),e.row.status===1?(d(),_(y,{key:1},{default:t(()=>[a("已编译")]),_:1})):f("",!0),e.row.status===2?(d(),_(y,{key:2},{default:t(()=>[a("编译失败")]),_:1})):f("",!0)]),_:1}),l(m,{align:"center",label:"操作",width:"200"},{default:t(e=>[l(u,{link:"",type:"primary",onClick:v=>r.handleEdit(e.row)},{default:t(()=>[a("编辑")]),_:2},1032,["onClick"]),e.row.status===0?(d(),_(u,{key:0,link:"",loading:o.loading_build,type:"primary",onClick:v=>r.handleBuild(e.row.id)},{default:t(()=>[a("编译")]),_:2},1032,["loading","onClick"])):f("",!0),l(u,{link:"",type:"danger",onClick:v=>r.handleDelete(e.row.id)},{default:t(()=>[a("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Q,o.listLoading]]),g("div",G,[l(z,{background:"","current-page":o.listQuery.page,"page-sizes":[10,20,30,50],"page-size":o.listQuery.page_size,layout:"total, sizes, prev, pager, next, jumper",total:o.total,onSizeChange:r.handleSizeChange,onCurrentChange:r.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])])]),l(S,{modelValue:o.centerDialogVisible,"onUpdate:modelValue":i[8]||(i[8]=e=>o.centerDialogVisible=e),title:"添加资源",width:"40%",center:""},{footer:t(()=>[l(u,{onClick:i[7]||(i[7]=e=>o.centerDialogVisible=!1)},{default:t(()=>[a("取 消")]),_:1}),l(u,{type:"primary",onClick:r.handleSubmit},{default:t(()=>[a("提交")]),_:1},8,["onClick"])]),default:t(()=>[l(C,{"label-width":"100"},{default:t(()=>[l(c,{label:"资源名称",docker_type_list:""},{default:t(()=>[l(h,{modelValue:o.form.name,"onUpdate:modelValue":i[2]||(i[2]=e=>o.form.name=e)},null,8,["modelValue"])]),_:1}),l(c,{label:"资源类型",required:""},{default:t(()=>[l(w,{modelValue:o.form.resource_type,"onUpdate:modelValue":i[3]||(i[3]=e=>o.form.resource_type=e)},{default:t(()=>[(d(!0),b(D,null,L(o.resource_type_list,e=>(d(),_(V,{label:e.label,key:e.id,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(c,{label:"加载类型",required:""},{default:t(()=>[l(w,{modelValue:o.form.docker_type,"onUpdate:modelValue":i[4]||(i[4]=e=>o.form.docker_type=e)},{default:t(()=>[(d(!0),b(D,null,L(o.docker_type_list,e=>(d(),_(V,{label:e.label,key:e.id,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(c,{label:"镜像名称"},{default:t(()=>[l(h,{modelValue:o.form.image,"onUpdate:modelValue":i[5]||(i[5]=e=>o.form.image=e)},null,8,["modelValue"])]),_:1}),l(c,{label:"描述"},{default:t(()=>[l(h,{modelValue:o.form.description,"onUpdate:modelValue":i[6]||(i[6]=e=>o.form.description=e)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(U,{onClose:r.handleSyncClose,open:o.syncDialog},null,8,["onClose","open"])])}const P=B(q,[["render",H]]);export{P as default};
