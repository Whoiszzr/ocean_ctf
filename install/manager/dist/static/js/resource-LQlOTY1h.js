import{_ as B,J as _,q as n,M as F,o as d,c as y,b as g,m as e,A as t,v as r,N,j as p,w as b,t as T,F as D,i as L}from"./index-QDrcbRr8.js";import q from"./docker_resource_sync-4HZtk5Tf.js";const E={name:"compose_db",components:{docker_resource_sync:q},data(){return{loading_build:!1,syncDialog:!1,docker_type_list:[{label:"远程镜像",id:1},{label:"本地镜像",id:2}],resource_type_list:[{label:"CTF",id:"CTF"},{label:"VUL",id:"VUL"}],form:{resource_type:"CTF",docker_type:1},centerDialogVisible:!1,listQuery:{},listLoading:!1,list:[],total:0}},created(){this.getList()},methods:{getList(){_.get("/api/admin/docker/resource",this.listQuery).then(s=>{let{data:o,total:k}=s;this.list=o,this.total=k})},handleCreate(){this.centerDialogVisible=!0},handleEdit(s){this.form=s,this.centerDialogVisible=!0},handleBuild(s){this.loading_build=!0,_.post(`/api/admin/docker/resource/${s}/build`).then(o=>{this.loading_build=!1,this.$message({message:"任务提交成功",type:"success"}),this.getList()})},handleDelete(s){_.delete(`/api/admin/docker/resource/${s}`).then(o=>{this.$message({message:"删除成功",type:"success"}),this.getList()})},handleSubmit(){this.form.id?_.put(`/api/admin/docker/resource/${this.form.id}`,this.form).then(s=>{this.$message({message:"修改成功",type:"success"}),this.form={},this.centerDialogVisible=!1,this.getList()}):_.post("/api/admin/docker/resource",this.form).then(s=>{this.$message({message:"添加成功",type:"success"}),this.form={},this.centerDialogVisible=!1,this.getList()})},handleSizeChange(s){this.listQuery.page_size=s,this.getList()},handleCurrentChange(s){this.listQuery.page=s,this.getList()},handleSyncClose(){this.syncDialog=!1,this.getList()}}},j={class:"page-container"},A={class:"widget"},J=g("div",{class:"tool-bar"},"资源中心",-1),M={class:"search-group"},G={class:"widget-content"},H={class:"page-r"};function I(s,o,k,K,i,a){const h=n("el-input"),c=n("el-form-item"),m=n("el-button"),C=n("el-form"),u=n("el-table-column"),f=n("el-tag"),x=n("el-table"),z=n("el-pagination"),V=n("el-option"),w=n("el-select"),S=n("el-dialog"),U=n("docker_resource_sync"),Q=F("loading");return d(),y("div",j,[g("div",A,[J,g("div",M,[e(C,{inline:""},{default:t(()=>[e(c,null,{default:t(()=>[e(h,{modelValue:i.listQuery.search,"onUpdate:modelValue":o[0]||(o[0]=l=>i.listQuery.search=l),style:{width:"200px"},placeholder:"名称"},null,8,["modelValue"])]),_:1}),e(c,null,{default:t(()=>[e(m,{type:"primary",onClick:o[1]||(o[1]=l=>a.getList())},{default:t(()=>[r("查询")]),_:1}),e(m,{type:"primary",onClick:a.handleCreate},{default:t(()=>[r("添加")]),_:1},8,["onClick"])]),_:1})]),_:1})]),g("div",G,[N((d(),p(x,{fit:"","highlight-current-row":"",stripe:"",data:i.list,style:{width:"100%"}},{default:t(()=>[e(u,{label:"名称",prop:"name",align:"center"}),e(u,{label:"镜像",prop:"image",width:"250px",align:"center"}),e(u,{label:"资源类型",prop:"resource_type",width:"150px",align:"center"}),e(u,{label:"加载类型",prop:"docker_type_name",width:"150px",align:"center"}),e(u,{label:"开放端口",prop:"ports",width:"150px",align:"center"}),e(u,{label:"描述",prop:"description",width:"150px","show-overflow-tooltip":"",align:"center"}),e(u,{width:"180px",align:"center",label:"状态"},{default:t(l=>[l.row.status===0?(d(),p(f,{key:0},{default:t(()=>[r("初始化")]),_:1})):b("",!0),l.row.status===1?(d(),p(f,{key:1},{default:t(()=>[r("已编译")]),_:1})):b("",!0),l.row.status===2?(d(),p(f,{key:2},{default:t(()=>[r("编译失败")]),_:1})):b("",!0)]),_:1}),e(u,{align:"center",label:"操作",width:"200"},{default:t(l=>[e(m,{link:"",type:"primary",onClick:v=>a.handleEdit(l.row)},{default:t(()=>[r("编辑")]),_:2},1032,["onClick"]),e(m,{link:"",loading:i.loading_build,type:"primary",onClick:v=>a.handleBuild(l.row.id)},{default:t(()=>[r(T(l.row.status===0?"编译":"重新编译"),1)]),_:2},1032,["loading","onClick"]),e(m,{link:"",type:"danger",onClick:v=>a.handleDelete(l.row.id)},{default:t(()=>[r("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Q,i.listLoading]]),g("div",H,[e(z,{background:"","current-page":i.listQuery.page,"page-sizes":[10,20,30,50],"page-size":i.listQuery.page_size,layout:"total, sizes, prev, pager, next, jumper",total:i.total,onSizeChange:a.handleSizeChange,onCurrentChange:a.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])])]),e(S,{modelValue:i.centerDialogVisible,"onUpdate:modelValue":o[8]||(o[8]=l=>i.centerDialogVisible=l),title:"添加资源",width:"40%",center:""},{footer:t(()=>[e(m,{onClick:o[7]||(o[7]=l=>i.centerDialogVisible=!1)},{default:t(()=>[r("取 消")]),_:1}),e(m,{type:"primary",onClick:a.handleSubmit},{default:t(()=>[r("提交")]),_:1},8,["onClick"])]),default:t(()=>[e(C,{"label-width":"100"},{default:t(()=>[e(c,{label:"资源名称",docker_type_list:""},{default:t(()=>[e(h,{modelValue:i.form.name,"onUpdate:modelValue":o[2]||(o[2]=l=>i.form.name=l)},null,8,["modelValue"])]),_:1}),e(c,{label:"资源类型",required:""},{default:t(()=>[e(w,{modelValue:i.form.resource_type,"onUpdate:modelValue":o[3]||(o[3]=l=>i.form.resource_type=l),filterable:""},{default:t(()=>[(d(!0),y(D,null,L(i.resource_type_list,l=>(d(),p(V,{label:l.label,key:l.id,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"加载类型",required:""},{default:t(()=>[e(w,{modelValue:i.form.docker_type,"onUpdate:modelValue":o[4]||(o[4]=l=>i.form.docker_type=l),filterable:""},{default:t(()=>[(d(!0),y(D,null,L(i.docker_type_list,l=>(d(),p(V,{label:l.label,key:l.id,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"镜像名称"},{default:t(()=>[e(h,{modelValue:i.form.image,"onUpdate:modelValue":o[5]||(o[5]=l=>i.form.image=l)},null,8,["modelValue"])]),_:1}),e(c,{label:"描述"},{default:t(()=>[e(h,{modelValue:i.form.description,"onUpdate:modelValue":o[6]||(o[6]=l=>i.form.description=l)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(U,{onClose:a.handleSyncClose,open:i.syncDialog},null,8,["onClose","open"])])}const R=B(E,[["render",I]]);export{R as default};
