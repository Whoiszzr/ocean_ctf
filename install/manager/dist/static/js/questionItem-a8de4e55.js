import{_ as O,az as u,q as r,o as m,j as d,A as i,m as a,v as g,c,F as b,i as v,b as h,t as B}from"./index-570ffed7.js";const D={name:"addQuestion",props:{show:Boolean,data:Object},data(){return{visible:!1,resource_list:[],hostOption:[],imageOption:[],capture:null,fileChange:!1,options:[],attachment:[],form:{attachment:[],resource_id:null,name:null,flag:null,desc:null,score:null,type:null,active:!0,active_flag:!1},rules:{name:[{required:!0,message:"请输入名称",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],type:[{required:!0,message:"请选择类别",trigger:"blur"}],desc:[{required:!0,message:"请填写描述信息",trigger:"blur"},{min:3,max:200,message:"长度在 3 到 200 个字符",trigger:"blur"}],flag:[{required:!0,message:"请输入flag",trigger:"blur"},{min:3,max:64,message:"长度在 3 到 64 个字符",trigger:"blur"}]}}},watch:{show(o){this.visible=o},data:{handler(o){o&&(this.form.id=this.data.id,this.form.name=this.data.name,this.form.flag=this.data.flag,this.form.desc=this.data.desc,this.form.active_flag=this.data.active_flag,this.form.type=this.data.type,this.form.active=this.data.active,this.form.score=this.data.score,this.form.resource_id=this.data.resource_id,this.data.attachment&&this.data.attachment.length>0&&(this.attachment=this.form.attachment))},deep:!0}},created(){this.getOptions(),this.getResourceList(),this.data.id&&(this.form.id=this.data.id,this.form.name=this.data.name,this.form.flag=this.data.flag,this.form.desc=this.data.desc,this.form.active_flag=this.data.active_flag,this.form.type=this.data.type,this.form.active=this.data.active,this.form.score=this.data.score,this.form.resource_id=this.data.resource_id,this.data.attachment.length>0&&(this.attachment=this.form.attachment))},methods:{getOptions(){u.get("/api/admin/ctf/question/type").then(o=>{this.options=o.data})},getResourceList(){u.get("/api/admin/docker/resource",{page_size:99999,status:1,type:"CTF"}).then(o=>{this.resource_list=o.data})},cancel(){this.$emit("action",!1)},submit(){this.form.attachment=[];for(let o=0;o<this.attachment.length;o++)this.form.attachment.push(this.attachment[o].uuid);this.$refs.form.validate(o=>{o&&(this.form.id?u.put(`/api/admin/ctf/question/${this.form.id}`,this.form).then(l=>{this.$emit("action",!0),this.$message({message:"提交成功",type:"success"})}).catch(l=>{}):u.post("/api/admin/ctf/question",this.form).then(l=>{this.$emit("action",!0)}).catch(l=>{}))})},handleFileClick(){document.getElementById("inputFile").click()},changeActiveFlag(o){},removeFile(o){this.fileChange=!0,this.attachment.splice(o,1)},handleFile(){let l=this.$refs.inputer.files[0],p=new FormData;p.append("file",l),u.post("/api/admin/ctf/upload",p).then(y=>{this.fileChange=!0;let{uuid:t,filename:s}=y;this.attachment.push({uuid:t,filename:s})})}}},I={style:{width:"300px"}},A={class:"file-item"},L=["href"],N=["onClick"];function j(o,l,p,y,t,s){const f=r("el-input"),n=r("el-form-item"),V=r("el-option"),k=r("el-select"),C=r("el-switch"),F=r("el-col"),w=r("el-row"),_=r("el-button"),q=r("el-form"),x=r("el-dialog");return m(),d(x,{"before-close":s.cancel,"show-close":!0,title:t.form.id?"编辑题目":"添加题目",modelValue:t.visible,"onUpdate:modelValue":l[9]||(l[9]=e=>t.visible=e),width:"40%"},{footer:i(()=>[a(_,{onClick:s.cancel},{default:i(()=>[g("取 消")]),_:1},8,["onClick"]),a(_,{type:"primary",onClick:s.submit},{default:i(()=>[g("确 定")]),_:1},8,["onClick"])]),default:i(()=>[a(q,{model:t.form,ref:"form",class:"form","label-width":"80px",rules:t.rules},{default:i(()=>[a(n,{label:"名称",prop:"name"},{default:i(()=>[a(f,{modelValue:t.form.name,"onUpdate:modelValue":l[0]||(l[0]=e=>t.form.name=e)},null,8,["modelValue"])]),_:1}),a(n,{label:"类别",prop:"type"},{default:i(()=>[a(k,{modelValue:t.form.type,"onUpdate:modelValue":l[1]||(l[1]=e=>t.form.type=e)},{default:i(()=>[(m(!0),c(b,null,v(t.options,e=>(m(),d(V,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(n,{class:"block-input",label:"是否激活"},{default:i(()=>[a(C,{modelValue:t.form.active,"onUpdate:modelValue":l[2]||(l[2]=e=>t.form.active=e)},null,8,["modelValue"])]),_:1}),a(n,{class:"block-input",label:"动态Flag"},{default:i(()=>[a(C,{modelValue:t.form.active_flag,"onUpdate:modelValue":l[3]||(l[3]=e=>t.form.active_flag=e),onChange:s.changeActiveFlag},null,8,["modelValue","onChange"])]),_:1}),t.form.active_flag?(m(),d(n,{key:0,required:"",class:"block-input",label:"环境",prop:"resource_id"},{default:i(()=>[a(k,{modelValue:t.form.resource_id,"onUpdate:modelValue":l[4]||(l[4]=e=>t.form.resource_id=e),clearable:""},{default:i(()=>[(m(!0),c(b,null,v(t.resource_list,e=>(m(),d(V,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):(m(),d(n,{key:1,class:"block-input",label:"Flag",prop:"flag"},{default:i(()=>[a(w,null,{default:i(()=>[a(F,{span:20},{default:i(()=>[a(f,{modelValue:t.form.flag,"onUpdate:modelValue":l[5]||(l[5]=e=>t.form.flag=e)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})),a(n,{label:"描述",prop:"desc"},{default:i(()=>[a(f,{modelValue:t.form.desc,"onUpdate:modelValue":l[6]||(l[6]=e=>t.form.desc=e),type:"textarea"},null,8,["modelValue"])]),_:1}),a(w,null,{default:i(()=>[a(F,{span:8},{default:i(()=>[a(n,{label:"积分",required:""},{default:i(()=>[a(f,{modelValue:t.form.score,"onUpdate:modelValue":l[7]||(l[7]=e=>t.form.score=e),type:"number"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(n,{label:"附件"},{default:i(()=>[h("input",{id:"inputFile",ref:"inputer",style:{display:"none"},type:"file",onChange:l[8]||(l[8]=(...e)=>s.handleFile&&s.handleFile(...e))},null,544),a(_,{type:"primary",onClick:s.handleFileClick},{default:i(()=>[g("上传")]),_:1},8,["onClick"]),h("div",I,[(m(!0),c(b,null,v(t.attachment,(e,U)=>(m(),c("div",A,[h("a",{href:e.filename,target:"_blank"},B(e.filename),9,L),h("i",{class:"el-icon-close",onClick:z=>s.removeFile(U)},null,8,N)]))),256))])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["before-close","title","modelValue"])}const M=O(D,[["render",j],["__scopeId","data-v-89eebe5d"]]);export{M as default};
